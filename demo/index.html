<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <title>Tidy Tree</title>
  <script src="//d3js.org/d3.v5.min.js"></script>
  <link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/spectre.css/0.5.8/spectre.min.css" />
	<style>
  html, body, .columns{
    height: 100%;
  }
  #options{
    height: 100%;
    background-color: lightgray;
  }
  [type="range"]{
    width: 100%;
  }
  #tree {
    height: 100%;
  }
  .node circle {
	  fill: #fff;
	  stroke: steelblue;
	  stroke-width: 3px;
	}
	.link {
    stroke-width: 2px;
	}
	</style>
</head>
<body class="container">
  <div class="columns">
    <div id="options" class="column col-auto">
      <h1 class="text-center">TidyTree</h1>
      <div class="form-group">
        <label>
          Source Data
          <input class="form-input" id="source" type="file">
        </label>
      </div>
      <div class="form-group">
        <label>
          Layout
          <select id="layout" class="form-select"></select>
        </label>
      </div>
      <div class="form-group">
        <label>
          Mode
          <select id="mode" class="form-select"></select>
        </label>
      </div>
      <div class="form-group">
        <label>
          Type
          <select id="type" class="form-select"></select>
        </label>
      </div>
      <div class="form-group">
        <label>
          Animation Speed
          <input id="animation" type="range" min="0" max="1000" value="500" step="1" />
        </label>
      </div>
      <div class="form-group">
        <label class="form-switch">
          <input id="branchNodes" type="checkbox" />
          <i class="form-icon"></i> Branch Nodes
        </label>
      </div>
      <div class="form-group">
        <label class="form-switch">
          <input id="branchLabels" type="checkbox" />
          <i class="form-icon"></i> Branch Labels
        </label>
      </div>
      <div class="form-group">
        <label class="form-switch">
          <input id="branchDistances" type="checkbox" />
          <i class="form-icon"></i> Branch Distances
        </label>
      </div>
      <div class="form-group">
        <label class="form-switch">
          <input id="leafNodes" type="checkbox" checked>
          <i class="form-icon"></i> Leaf Nodes
        </label>
      </div>
      <div class="form-group">
        <label class="form-switch">
          <input id="leafLabels" type="checkbox" />
          <i class="form-icon"></i> Leaf Labels
        </label>
      </div>
      <div class="form-group">
        <label>
          Leaf Label Size
          <input id="leafLabelSize" type="range" min="1" max="32" value="6" step="1" />
        </label>
      </div>
    </div>
    <div id="tree" class="column"></div>
  </div>
<script src="//unpkg.com/patristic@0.1.0/dist/patristic.js"></script>
<script src="../index.js"></script>
<script>
var tree;

['layout', 'mode', 'type'].forEach(thing => {
  var title = 'valid' + thing[0].toUpperCase() + thing.slice(1) + 's';
  d3.select('#'+thing).selectAll('option').data(TidyTree[title])
    .enter().append('option')
    .text(d => d);
});

fetch('life.nwk').then(function(response){
  response.text().then(t => {
    tree = new TidyTree(t, {
      parent: '#tree',
      layout: d3.select('#layout').node().value,
      mode: d3.select('#mode').node().value,
      type: d3.select('#type').node().value,
      leafNodes: d3.select('#leafNodes').node().checked,
      branchNodes: d3.select('#branchNodes').node().checked,
      leafLabels: d3.select('#leafLabels').node().checked,
      branchLabels: d3.select('#branchLabels').node().checked,
      branchDistances: d3.select('#branchDistances').node().checked,
      animation: parseFloat(d3.select('#animation').node().value)
    });
  });
});

d3.select('#source').on('input', function(){
  let reader = new FileReader();
  reader.onload = function(){
    d3.select('#tree').html(null);
    tree = new TidyTree(reader.result, {
      parent: '#tree',
      layout: d3.select('#layout').node().value,
      mode: d3.select('#mode').node().value,
      type: d3.select('#type').node().value,
      leafNodes: d3.select('#leafNodes').node().checked,
      branchNodes: d3.select('#branchNodes').node().checked,
      leafLabels: d3.select('#leafLabels').node().checked,
      branchLabels: d3.select('#branchLabels').node().checked,
      branchDistances: d3.select('#branchDistances').node().checked,
      animation: parseFloat(d3.select('#animation').node().value)
    });
  };
  reader.readAsText(d3.event.srcElement.files[0]);
});

d3.selectAll('select').on('change', function(){
  var thing = this.id[0].toUpperCase() + this.id.slice(1);
  tree['set'+thing](this.value);
  tree.recenter();
});

d3.selectAll('input').on('change', function(){
  var thing = this.id[0].toUpperCase() + this.id.slice(1);
  if(this.type === 'checkbox'){
    tree['set' + thing](this.checked);
  }
  if(this.type === 'range'){
    tree['set' + thing](parseFloat(this.value));
  }
});

</script>
</body>
</html>
